<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thermite</title>
    <style>
        :root {
        --block-color: #394D61;
        --bg-color: #16181C;
        }
        body{
        background-color: var(--bg-color);
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
        }
        div.grid{
        margin: 20px auto;
        width: 480px;
        height: 480px;
        background: #2D3139;
        display: grid;
        grid-template-columns: 1fr 1fr 1fr 1fr;
        grid-template-rows: 1fr 1fr 1fr 1fr;
        gap: 20px;
        padding: 10px;
        }
        .grid.won .block{
        background: #008d00;
        }
        .grid.lost .block{
        background: #F22300;
        }

        .block{
        background: #131313;
        width: 100%;
        height: 100%;
        border-radius: 2px;
        cursor: pointer;
        }
        .block.show,.block.correct{
        background: #d6d6d6;
        }
        .block.incorrect{
        background: #800000;
        }
        .grid.lost .show.block {
        background: #6d9070;
        }
        .grid.lost .block {
        background: #bd5151;
        }

        .grid.lost .block.clicked.incorrect {
        background: #F22300;
        }
        .grid.lost .block.clicked.correct {
        background: #bfbfbf;
        }

        .restart-button{
        display: block;
        padding: 12px 60px;
        background: #394D61;
        color: white;
        margin-top: 30px;
        font-weight: bold;
        font-size: 18px;
        cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="grid">
    <div class="block block-1"></div>
    <div class="block block-2"></div>
    <div class="block block-3"></div>
    <div class="block block-4"></div>
    <div class="block block-5"></div>
    <div class="block block-6"></div>
    <div class="block block-7"></div>
    <div class="block block-8"></div>
    <div class="block block-9"></div>
    <div class="block block-10"></div>
    <div class="block block-11"></div>
    <div class="block block-12"></div>
    <div class="block block-13"></div>
    <div class="block block-14"></div>
    <div class="block block-15"></div>
    <div class="block block-16"></div>
  
</div>

<div class="button-row">
  <span class="restart-button">Restart</span>
</div>

<script>
    window.timeBlocksShows = 4.5; //4.5sec
    window.timeUntilLose = 12; //12sec
    window.correctBlocksNum = 6;
    window.maxIncorrectBlocksNum = 2;
    window.allBlocksNum = 16;
    window.activateClicking = false;

    function generateRandomNumberBetween(min=1,max=window.allBlocksNum,length = window.correctBlocksNum){
        var arr = [];
        while(arr.length < length){
            var r = Math.floor(Math.random() * (max+1-min)) + min;
            if(arr.indexOf(r) === -1) arr.push(r);
        }
        return arr;
    }

    function onBlockClick(e){
        if(!window.activateClicking){
            return;
        }
        let clickedBlock = e.target;
        let blockNum = clickedBlock.classList.value.match(/(?:block-)(\d+)/)[1];
        blockNum = Number(blockNum);
        let correctBlocks = window.gridCorrectBlocks;
        let correct = correctBlocks.indexOf(blockNum) !== -1;
        clickedBlock.classList.add("clicked");
        console.log(blockNum, correct, correctBlocks);
        if(correct){
            clickedBlock.classList.remove("incorrect");
            clickedBlock.classList.add("correct");
        }
        else{
            clickedBlock.classList.add("incorrect");
            clickedBlock.classList.remove("correct");
        }
        checkWinOrLost();
    }

    function showCorrectBlocks(){
        document.querySelectorAll('.block').forEach(ele => {
            let blockNum = ele.classList.value.match(/(?:block-)(\d+)/)[1];
            blockNum = Number(blockNum);
            let correctBlocks = window.gridCorrectBlocks;
            let correct = correctBlocks.indexOf(blockNum) !== -1;
            if(correct){
                ele.classList.add("show");
            }
        });
    }
    function hideAllBlocks(){
        document.querySelectorAll('.block').forEach(ele => {
            ele.classList.remove("show");
            ele.classList.remove("correct");
            ele.classList.remove("incorrect");
            ele.classList.remove("clicked");
        });
    }

    function restartGame(){
        document.querySelector('.grid').classList.remove("won");
        document.querySelector('.grid').classList.remove("lost");
        hideAllBlocks();
        window.gridCorrectBlocks = generateRandomNumberBetween();
        window.activateClicking = false;
        showCorrectBlocks();
        setTimeout(()=>{
            hideAllBlocks();
            window.activateClicking = true;
            console.log("Restarted")
        }, window.timeBlocksShows*1000);
    }

    function checkWinOrLost(){
        if(isGameWon()){
            document.querySelector('.grid').classList.add("won");
            window.activateClicking = false;
            return "won";
        }
        if(isGameLost()){
            document.querySelector('.grid').classList.add("lost");
            showCorrectBlocks();
            window.activateClicking = false;
            return "lost";
        }
    }

    function isGameWon(){
        return document.querySelectorAll(".correct").length >= window.correctBlocksNum;
    }
    function isGameLost(){
        return document.querySelectorAll(".incorrect").length >= window.maxIncorrectBlocksNum;
    }

    // Attach event listeners after DOM is loaded
    window.addEventListener('DOMContentLoaded', () => {
        document.querySelectorAll('.block').forEach(block => {
            block.addEventListener('click', onBlockClick);
        });
        document.querySelector('.restart-button').addEventListener('click', restartGame);
        document.querySelector('.grid').addEventListener('click', function(e) {
            if (this.classList.contains('won') || this.classList.contains('lost')) {
                restartGame();
            }
        });
        restartGame();
    });
</script>
</body>
</html>